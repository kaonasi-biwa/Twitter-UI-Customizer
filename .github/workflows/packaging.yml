name: Build
on: push


jobs:
  make-release:
    runs-on: ubuntu-latest
    steps:
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        release_name: Twitter UI Customizer
        draft: false
        prerelease: false

  build-firefox:
    needs: make-release
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Archive
      run: |
        rm manifest_chrome.json
        zip -r Twitter_UI_Customizer_Firefox.xpi ./ -x "*.git*"
    - name: Upload Release Asset
      id: upload-release-asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ needs.create_release.outputs.upload_url }}
        asset_path: Twitter_UI_Customizer_Firefox.xpi
        asset_name: Twitter_UI_Customizer_Firefox.xpi
        asset_content_type: application/zip

  build-chromium:
    needs: make-release
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Archive
      run: |
        rm manifest.json
        mv manifest_chrome.json manifest.json
        zip -r Twitter_UI_Customizer_Chromium.zip ./ -x "*.git*"

    - name: Upload Release Asset
      id: upload-release-asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ needs.create_release.outputs.upload_url }}
        asset_path: Twitter_UI_Customizer_Chromium.zip
        asset_name: Twitter_UI_Customizer_Chromium.zip
        asset_content_type: application/zip
